<?php
    declare(strict_types=1);
    /** @var InlineImagesExtension $this */

    $config = $this->getUserConfiguration();
    $enabledFeeds = $config['enabled_feeds'] ?? [];

    // Get all feeds
    $feedDAO = FreshRSS_Factory::createFeedDao();
    $feeds = $feedDAO->listFeeds();
?>

<div class="alert alert-info">
    <p><?= _t('ext.inlineimages.config.info') ?></p>
</div>

<form action="<?= _url('extension', 'configure', 'e', urlencode($this->getName())); ?>" method="post">
    <input type="hidden" name="_csrf" value="<?= FreshRSS_Auth::csrfToken() ?>" />

    <div class="form-group">
        <label class="group-name"><?= _t('ext.inlineimages.config.enable_for_feeds') ?></label>
        <div class="group-controls">
            <?php if (empty($feeds)): ?>
                <p class="alert alert-warn"><?= _t('ext.inlineimages.config.no_feeds') ?></p>
            <?php else: ?>
                <div style="max-height: 400px; overflow-y: auto; padding: 10px; border: 1px solid #ddd;">
                    <?php foreach ($feeds as $feed): ?>
                        <div style="margin-bottom: 8px;">
                            <label style="display: flex; align-items: center; cursor: pointer;">
                                <input type="checkbox"
                                       name="enabled_feeds[<?= $feed->id() ?>]"
                                       style="margin-right: 8px;"
                                       <?= !empty($enabledFeeds[$feed->id()]) ? 'checked' : '' ?> />
                                <span style="flex: 1;">
                                    <?= htmlspecialchars($feed->name(), ENT_COMPAT, 'UTF-8') ?>
                                </span>
                                <span style="color: #888; font-size: 0.9em; margin-left: 10px;">
                                    <?= htmlspecialchars($feed->url(), ENT_COMPAT, 'UTF-8') ?>
                                </span>
                            </label>
                        </div>
                    <?php endforeach; ?>
                </div>

                <p style="margin-top: 10px; font-size: 0.9em; color: #666;">
                    <?= _t('ext.inlineimages.config.feed_count', count($feeds), count($enabledFeeds)) ?>
                </p>
            <?php endif; ?>
        </div>
    </div>

    <div class="form-group">
        <label class="group-name"><?= _t('ext.inlineimages.config.settings') ?></label>
        <div class="group-controls">
            <ul style="list-style: disc; margin-left: 20px; color: #666;">
                <li><?= _t('ext.inlineimages.config.max_size') ?></li>
                <li><?= _t('ext.inlineimages.config.quality') ?></li>
                <li><?= _t('ext.inlineimages.config.timeout') ?></li>
                <li><?= _t('ext.inlineimages.config.max_file_size') ?></li>
            </ul>
        </div>
    </div>

    <div class="form-group form-actions">
        <div class="group-controls">
            <button type="submit" class="btn btn-important">
                <?= _t('gen.action.submit') ?>
            </button>
            <button type="reset" class="btn">
                <?= _t('gen.action.cancel') ?>
            </button>
        </div>
    </div>
</form>
